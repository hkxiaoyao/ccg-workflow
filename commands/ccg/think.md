---
description: UltraThink 深度分析（双模型并行分析 + 综合见解）
---

# /ccg:think - 深度分析

## Usage
`/ccg:think <分析主题>`

## Context
- 分析主题: $ARGUMENTS
- 使用双模型进行多角度深度分析
- 适用于复杂架构决策、技术选型、问题探索

## 工作流程

**注意**: 本命令使用 MCP 代码检索工具。请先读取 `~/.ccg/config.toml` 确定 MCP 提供商（ace-tool 或 auggie），然后使用对应的工具。

### Phase 1: 上下文收集

1. **调用代码检索工具**:
   - 根据 `~/.ccg/config.toml` 中 `[mcp.tools] code_search_{provider}` 调用对应工具
   - 参数：`project_root_path`（项目根目录）, 查询参数使用配置中 `query_param_{provider}` 对应的名称
   - 查询参数名使用 `query_param_{provider}` 的值（"query" 或 "information_request"）
2. 识别分析范围和关键组件
3. 列出已知约束和假设

### Phase 2: 并行深度分析

**同时启动（`run_in_background: true`）**：

**注意**：调用前先读取对应角色提示词文件，将内容注入到 `<ROLE>` 标签中。

#### Codex 分析（后端/系统视角）
```bash
codeagent-wrapper --backend codex - $PROJECT_DIR <<'EOF'
<ROLE>
读取 prompts/codex/analyzer.md 的内容并注入
</ROLE>

<TASK>
Deep analysis of: <分析主题>

Context:
<相关代码和架构信息>
</TASK>

OUTPUT: Structured analysis report with clear reasoning.
EOF
```

#### Gemini 分析（前端/用户视角）
```bash
codeagent-wrapper --backend gemini - $PROJECT_DIR <<'EOF'
<ROLE>
读取 prompts/gemini/analyzer.md 的内容并注入
</ROLE>

<TASK>
Deep analysis of: <分析主题>

Context:
<相关代码和设计信息>
</TASK>

OUTPUT: Structured analysis report with clear reasoning.
EOF
```

### Phase 3: UltraThink 综合

1. 收集双模型分析报告（使用 `TaskOutput`）
2. **交叉验证**：
   - 识别一致的观点（强信号）
   - 分析分歧点（需要权衡）
   - 发现互补的见解
3. **综合推理**：
   - 整合技术和用户视角
   - 形成统一的分析框架
   - 生成可行的建议

### Phase 4: 输出结论

生成结构化的分析报告，包含清晰的推理过程和可执行的建议。

## 输出格式

```
## 🧠 深度分析: <分析主题>

### Phase 1: 上下文
- 分析范围: <涉及的模块/文件>
- 关键约束: <已知限制>
- 假设前提: <假设列表>

### Phase 2: 双模型分析

#### Codex 视角（后端/系统）
**问题分解**:
<分解结果>

**技术评估**:
<评估结果>

**方案探索**:
| 方案 | 优点 | 缺点 | 可行性 |
|------|------|------|--------|
| A    | ...  | ...  | High   |
| B    | ...  | ...  | Medium |

#### Gemini 视角（前端/用户）
**用户影响**:
<影响分析>

**设计评估**:
<评估结果>

**实现考量**:
<考量点>

### Phase 3: 综合分析

#### 一致观点（强信号）
1. <双方都认同的点>
2. <双方都认同的点>

#### 分歧点（需权衡）
| 议题 | Codex 观点 | Gemini 观点 | 建议 |
|------|------------|-------------|------|
| ... | ... | ... | ... |

#### 互补见解
- Codex 补充: <技术深度>
- Gemini 补充: <用户视角>

### Phase 4: 结论与建议

#### 核心结论
<1-2 句话总结>

#### 推荐方案
**首选**: <方案描述>
- 理由: <为什么选择>
- 风险: <潜在风险>
- 缓解: <如何应对>

#### 行动计划
1. [ ] <短期行动>
2. [ ] <中期行动>
3. [ ] <长期行动>

#### 待确认事项
- <需要进一步调研的问题>
- <需要用户决策的事项>
```

## 适用场景

| 场景 | 示例 |
|------|------|
| 架构决策 | "评估微服务拆分方案" |
| 技术选型 | "比较 Redux vs Zustand" |
| 性能分析 | "分析页面加载慢的原因" |
| 重构评估 | "评估重构遗留模块的风险" |
| 问题探索 | "为什么用户流失率高" |

## 分析质量标准

- [ ] 问题被充分分解
- [ ] 多角度视角覆盖
- [ ] Trade-off 明确列出
- [ ] 结论有证据支撑
- [ ] 行动项可执行

## 关键原则

1. **不急于结论** - 充分收集和分析后再下结论
2. **多视角思考** - 技术 + 用户 + 业务
3. **量化权衡** - 尽可能用数据支撑判断
4. **可执行导向** - 分析结果要能指导行动
