---
description: 'äº¤äº’å¼ Git å›æ»šï¼šå®‰å…¨å›æ»šåˆ†æ”¯åˆ°å†å²ç‰ˆæœ¬ï¼Œæ”¯æŒ reset/revert æ¨¡å¼'
---

# Rollback - äº¤äº’å¼ Git å›æ»š

å®‰å…¨åœ°å°†åˆ†æ”¯å›æ»šåˆ°æŒ‡å®šå†å²ç‰ˆæœ¬ï¼Œé»˜è®¤ dry-run æ¨¡å¼ã€‚

## ä½¿ç”¨æ–¹æ³•

```bash
/rollback [options]
```

## é€‰é¡¹

| é€‰é¡¹ | è¯´æ˜ |
|------|------|
| `--branch <branch>` | è¦å›æ»šçš„åˆ†æ”¯ |
| `--target <rev>` | ç›®æ ‡ç‰ˆæœ¬ï¼ˆcommit/tag/reflogï¼‰ |
| `--mode reset\|revert` | å›æ»šæ¨¡å¼ |
| `--depth <n>` | åˆ—å‡ºæœ€è¿‘ n ä¸ªç‰ˆæœ¬ï¼ˆé»˜è®¤ 20ï¼‰ |
| `--dry-run` | åªé¢„è§ˆï¼Œä¸æ‰§è¡Œï¼ˆ**é»˜è®¤**ï¼‰ |
| `--yes` | è·³è¿‡ç¡®è®¤ç›´æ¥æ‰§è¡Œ |

---

## æ‰§è¡Œå·¥ä½œæµ

### ğŸ” é˜¶æ®µ 1ï¼šåŒæ­¥è¿œç«¯

`[æ¨¡å¼ï¼šå‡†å¤‡]`

```bash
git fetch --all --prune
```

### ğŸ“‹ é˜¶æ®µ 2ï¼šé€‰æ‹©åˆ†æ”¯

`[æ¨¡å¼ï¼šé€‰æ‹©]`

1. åˆ—å‡ºæœ¬åœ° + è¿œç«¯åˆ†æ”¯
2. è¿‡æ»¤å—ä¿æŠ¤åˆ†æ”¯
3. ç”¨æˆ·é€‰æ‹©æˆ–ä½¿ç”¨ `--branch` å‚æ•°

### ğŸ“œ é˜¶æ®µ 3ï¼šé€‰æ‹©ç‰ˆæœ¬

`[æ¨¡å¼ï¼šé€‰æ‹©]`

1. æ˜¾ç¤ºæœ€è¿‘ N ä¸ªç‰ˆæœ¬ï¼ˆ`git log --oneline`ï¼‰
2. æ˜¾ç¤ºç›¸å…³ tagsï¼ˆ`git tag --merged`ï¼‰
3. ç”¨æˆ·é€‰æ‹©æˆ–ä½¿ç”¨ `--target` å‚æ•°

### âš™ï¸ é˜¶æ®µ 4ï¼šé€‰æ‹©æ¨¡å¼

`[æ¨¡å¼ï¼šå†³ç­–]`

| æ¨¡å¼ | è¯´æ˜ | æ¨é€æ–¹å¼ |
|------|------|----------|
| `reset` | ç¡¬å›æ»šï¼Œæ”¹å˜å†å² | `--force-with-lease` |
| `revert` | ç”Ÿæˆåå‘æäº¤ï¼Œä¿ç•™å†å² | æ™®é€š push |

### â›” é˜¶æ®µ 5ï¼šæœ€ç»ˆç¡®è®¤

`[æ¨¡å¼ï¼šç¡®è®¤]`

æ˜¾ç¤ºå³å°†æ‰§è¡Œçš„å‘½ä»¤ï¼Œç­‰å¾…ç”¨æˆ·ç¡®è®¤ï¼ˆé™¤é `--yes`ï¼‰ã€‚

### âœ… é˜¶æ®µ 6ï¼šæ‰§è¡Œå›æ»š

`[æ¨¡å¼ï¼šæ‰§è¡Œ]`

**reset æ¨¡å¼**ï¼š
```bash
git switch <branch>
git reset --hard <target>
```

**revert æ¨¡å¼**ï¼š
```bash
git switch <branch>
git revert --no-edit <target>..HEAD
```

---

## å®‰å…¨æŠ¤æ 

1. **å¤‡ä»½**ï¼šæ‰§è¡Œå‰è‡ªåŠ¨è®°å½•å½“å‰ HEAD åˆ° reflog
2. **ä¿æŠ¤åˆ†æ”¯**ï¼š`main`/`master`/`production` éœ€é¢å¤–ç¡®è®¤
3. **dry-run é»˜è®¤**ï¼šé˜²æ­¢è¯¯æ“ä½œ
4. **ç¦æ­¢ --force**ï¼šå¦‚éœ€å¼ºæ¨ï¼Œæ‰‹åŠ¨æ‰§è¡Œ

---

## ç¤ºä¾‹

```bash
# å…¨äº¤äº’æ¨¡å¼ï¼ˆdry-runï¼‰
/rollback

# æŒ‡å®šåˆ†æ”¯
/rollback --branch dev

# å®Œæ•´æŒ‡å®šï¼Œä¸€é”®æ‰§è¡Œ
/rollback --branch main --target v1.2.0 --mode reset --yes

# ç”Ÿæˆåå‘æäº¤
/rollback --branch release/v2.1 --target v2.0.5 --mode revert
```

## æ³¨æ„äº‹é¡¹

- **reset vs revert**ï¼šreset æ”¹å˜å†å²ï¼Œéœ€å¼ºæ¨ï¼›revert æ›´å®‰å…¨
- **LFS/å­æ¨¡å—**ï¼šå›æ»šå‰ç¡®ä¿çŠ¶æ€ä¸€è‡´
- **CI è§¦å‘**ï¼šå›æ»šåå¯èƒ½è‡ªåŠ¨è§¦å‘æµæ°´çº¿
